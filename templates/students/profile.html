{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="card border-0 shadow-lg rounded-4 overflow-hidden">

<!-- Header Section -->
<div class="position-relative overflow-hidden mb-4">
    <!-- Background Gradient + Optional Subtle Pattern -->
    <div class="position-absolute top-0 start-0 w-100 h-100" 
         style="background: linear-gradient(135deg, #1e3c72, #2a5298);"></div>
    <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10" 
         style="background-image: url('{% static 'images/pattern.svg' %}'); background-size: cover;"></div>

    <div class="container position-relative py-5 d-flex flex-column flex-md-row align-items-center gap-4" style="z-index: 2; color: #fff;">
        <!-- Profile Picture -->
        {% if details and details.profile_picture %}
            <img src="{{ details.profile_picture.url }}" 
                 alt="Profile Photo" 
                 class="rounded-circle border border-4 border-white shadow-lg"
                 style="width: 180px; height: 180px; object-fit: cover;">
        {% else %}
            <img src="{% static 'images/default_profile.png' %}" 
                 alt="Default Profile" 
                 class="rounded-circle border border-4 border-white shadow-lg"
                 style="width: 180px; height: 180px; object-fit: cover;">
        {% endif %}

        <!-- Name & Info -->
        <div class="flex-grow-1 text-center text-md-start">
            <!-- Student Name -->
            <h1 class="fw-bold display-4 mb-2 text-shadow" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                {{ student.name }}
            </h1>

            <!-- Room Number & Phone Number (Slightly smaller than name) -->
            <h2 class="fw-bold display-5 text-lg mb-2 text-shadow">
                <i class="bi bi-door-open"></i> Room {{ student.room_number }}
            </h2>
            {% if details %}
            <h2 class="fw-bold display-5 text-lg mb-2 text-shadow">
                <i class="bi bi-telephone"></i> {{ details.phone_number }}
            </h2>
            {% endif %}
        </div>
    </div>
</div>


        <!-- Details Section -->
        <div class="card-body bg-light">
            <div class="row g-4">
                <!-- Personal Info -->
                <div class="col-lg-6">
                    <div class="p-4 bg-white rounded-4 shadow-sm h-100">
                        <h5 class="fw-bold border-bottom pb-2 text-primary">
                            <i class="bi bi-person-lines-fill"></i> Personal Information
                        </h5>
                        <div class="mt-3">
                            <p><strong>Full Name:</strong> {{ student.name }}</p>
                            <p><strong>Room Number:</strong> {{ student.room_number }}</p>
                            {% if details %}
                                <p><strong>University ID:</strong> {{ details.university_id }}</p>
                                <p><strong>Department:</strong> {{ details.department }}</p>
                                <p><strong>Batch:</strong> {{ details.batch }}</p>
                                <p><strong>Date of Birth:</strong> {{ details.date_of_birth|date:"F j, Y" }}</p>
                                <p><strong>Address:</strong> {{ details.address }}</p>
                            {% else %}
                                <div class="alert alert-warning mt-2">
                                    No detailed profile found. Please contact your hostel manager.
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Contact & Guardian Info -->
                <div class="col-lg-6">
                    <div class="p-4 bg-white rounded-4 shadow-sm h-100">
                        <h5 class="fw-bold border-bottom pb-2 text-primary">
                            <i class="bi bi-telephone"></i> Contact Information
                        </h5>
                        {% if details %}
                            <div class="mt-3">
                                <p><strong>Email:</strong> {{ student.user.email|default:"No email provided" }}</p>
                                <p><strong>Phone:</strong> {{ details.phone_number }}</p>
                                <p><strong>Guardian Name:</strong> {{ details.guardian_name }}</p>
                                <p><strong>Guardian Phone:</strong> {{ details.guardian_phone }}</p>
                                <p><strong>Blood Group:</strong> {{ details.blood_group }}</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Meal Preferences -->
            <div class="mt-4 p-4 bg-white rounded-4 shadow-sm">
                <h5 class="fw-bold border-bottom pb-2 text-primary">
                    <i class="bi bi-egg-fried"></i> Meal Preferences
                </h5>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <strong>Beef Preference:</strong>
                        {% if latest_meal %}
                            {% if latest_meal.prefers_beef %}
                                <span class="badge bg-success ms-2">Beef</span>
                            {% else %}
                                <span class="badge bg-warning text-dark ms-2">Mutton</span>
                            {% endif %}
                        {% else %}
                            {% if student.default_prefers_beef %}
                                <span class="badge bg-success ms-2">Beef</span>
                            {% else %}
                                <span class="badge bg-warning text-dark ms-2">Mutton</span>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <strong>Fish Preference:</strong>
                        {% if latest_meal %}
                            {% if latest_meal.prefers_fish %}
                                <span class="badge bg-success ms-2">Fish</span>
                            {% else %}
                                <span class="badge bg-warning text-dark ms-2">Egg</span>
                            {% endif %}
                        {% else %}
                            {% if student.default_prefers_fish %}
                                <span class="badge bg-success ms-2">Fish</span>
                            {% else %}
                                <span class="badge bg-warning text-dark ms-2">Egg</span>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>


            <!-- Last Updated Info -->
            {% if details %}
            <div class="text-end mt-4">
                <small class="text-muted">
                    <i class="bi bi-clock-history"></i> 
                    Last updated on {{ details.updated_at|date:"F j, Y, g:i A" }}
                </small>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
