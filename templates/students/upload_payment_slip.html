{% extends "base.html" %}

{% block page_title %}
<div class="px-4 sm:px-6 lg:px-8">
  <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-xl shadow-sm inline-flex items-center space-x-3 w-fit hover:from-blue-700 hover:to-blue-900 transition">
    <div>
      <h2 class="text-2xl font-bold text-white">
        <i class="fas fa-file-invoice-dollar text-white text-3xl mr-2"></i>
        Payment Slips
      </h2>
      <p class="text-md text-white mt-1">Upload and track your payment slips</p>
    </div>
  </div>
</div>
{% endblock page_title %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8">

  <!-- Back to Dashboard -->
  <a href="{% url 'accounts:home' %}" 
     class="inline-flex items-center gap-2 bg-gradient-to-r from-gray-600 to-gray-800 text-white px-4 py-2 rounded-full font-semibold shadow hover:from-gray-700 hover:to-gray-900 transition mb-6">
    <i class="fas fa-arrow-left text-white"></i> Back to Dashboard
  </a>

    <!-- Upload Form Card -->
    <div class="relative rounded-3xl shadow-2xl p-8 transition transform hover:-translate-y-1 
                bg-gradient-to-br from-blue-50 to-blue-200 border-l-8 border-blue-600">

    <!-- Card Title -->
    <h3 class="text-2xl font-extrabold text-center text-blue-800 mb-6">
        <i class="fas fa-file-upload mr-2"></i> Upload New Payment Slip
    </h3>

    {% if has_verified_slips %}
    <p class="text-center text-green-700 font-medium mb-6">
        Note: Verified slips cannot be edited or resubmitted.
    </p>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <!-- Month -->
        <div class="flex flex-col">
            {{ form.month.label_tag }}
            {{ form.month }}
            {{ form.month.errors }}
        </div>

        <!-- Amount -->
        <div class="flex flex-col">
            {{ form.amount.label_tag }}
            {{ form.amount }}
            {{ form.amount.errors }}
        </div>

        <!-- Transaction ID -->
        <div class="flex flex-col">
            {{ form.transaction_id.label_tag }}
            {{ form.transaction_id }}
            {{ form.transaction_id.errors }}
        </div>

        <!-- Account Number -->
        <div class="flex flex-col">
            {{ form.account_number.label_tag }}
            {{ form.account_number }}
            {{ form.account_number.errors }}
        </div>

        <!-- Slip Image -->
        <div class="flex flex-col md:col-span-2">
            {{ form.slip_image.label_tag }}
            {{ form.slip_image }}
            {{ form.slip_image.errors }}
        </div>

        <!-- Info -->
        <div class="flex flex-col md:col-span-2">
            {{ form.info.label_tag }}
            {{ form.info }}
            {{ form.info.errors }}
        </div>

        <!-- Submit Button -->
        <div class="md:col-span-2 flex justify-center mt-4">
            <button type="submit"
                class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-2xl shadow-lg hover:from-blue-700 hover:to-blue-900 transition font-semibold text-lg"
                {% if has_verified_slips %}disabled title="Cannot edit verified slips"{% endif %}>
                Upload Slip
            </button>
        </div>
    </form>
    </div>


  <!-- Existing Payment Slips -->
  <div class="space-y-8">
    <h3 class="text-xl font-semibold text-gray-800">Your Payment Slips</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for slip in slips %}
      <div class="relative rounded-2xl shadow-2xl p-6 flex flex-col transition transform hover:-translate-y-1
                  {% if slip.is_verified %}
                    bg-gradient-to-br from-green-50 to-green-100 border-l-8 border-green-600
                  {% else %}
                    bg-gradient-to-br from-yellow-50 to-yellow-100 border-l-8 border-yellow-400
                  {% endif %}">

        {% if slip.slip_image %}
        <a href="{{ slip.slip_image.url }}" target="_blank">
          <img src="{{ slip.slip_image.url }}" alt="Slip Image" 
               class="rounded-xl shadow-md border border-gray-200 w-full h-48 object-cover mb-4 hover:scale-105 transition-transform">
        </a>
        {% endif %}

        <div class="space-y-1">
          <h4 class="text-md font-semibold text-gray-800">Month: {{ slip.month }}</h4>
          <p><strong>Amount:</strong> {{ slip.amount }} Taka</p>
          {% if slip.transaction_id %}<p><strong>Transaction ID:</strong> {{ slip.transaction_id }}</p>{% endif %}
          {% if slip.account_number %}<p><strong>Account Number:</strong> {{ slip.account_number }}</p>{% endif %}
          {% if slip.info %}<p><strong>Info:</strong> {{ slip.info }}</p>{% endif %}
        </div>

        <div class="mt-4 flex items-center justify-between">
          {% if slip.is_verified %}
          <span class="bg-green-600 text-white px-3 py-1 rounded-full text-xs font-semibold">Verified</span>
          {% else %}
          <span class="bg-yellow-500 text-white px-3 py-1 rounded-full text-xs font-semibold">Pending</span>
          {% endif %}

          {% if slip.slip_image %}
          <a href="{{ slip.slip_image.url }}" target="_blank"
             class="px-3 py-1 bg-gray-200 rounded-xl shadow hover:bg-gray-300 text-sm font-medium">
            View Image
          </a>
          {% endif %}
        </div>

      </div>
      {% empty %}
      <p class="col-span-full text-gray-600 text-center mt-10">No payment slips uploaded yet.</p>
      {% endfor %}
    </div>
  </div>

</div>
{% endblock %}
