{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto px-6 py-10">

  <!-- Header -->
  <div class="flex justify-center mb-10">
    <div class="flex items-center space-x-3 bg-gradient-to-r from-blue-600 to-indigo-700 text-white px-8 py-3 rounded-2xl shadow-lg">
      <i class="fas fa-chart-line text-yellow-300 text-2xl"></i>
      <h2 class="text-2xl font-semibold tracking-wide">Monthly Meal Summary</h2>
    </div>
  </div>

  <!-- Month Selector -->
  <form method="get" class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-10">
    <select name="month" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500">
      <option value="">Select Month</option>
      {% for month in months %}
      <option value="{{ month }}" {% if month == selected_month %}selected{% endif %}>{{ month }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg shadow transition">
      Generate Report
    </button>
  </form>

  {% if selected_month %}
  <!-- Summary Stats -->
  <div class="grid md:grid-cols-4 gap-6 mb-10">
    <!-- Total Students -->
    <div class="bg-green-50 rounded-xl p-6 shadow text-center">
      <i class="fas fa-user-friends text-green-600 text-2xl mb-2"></i>
      <div class="text-lg font-semibold">Total Students</div>
      <div class="text-2xl font-bold text-green-700">{{ summaries|length }}</div>
    </div>

    <!-- Total Cost -->
    <div class="bg-yellow-50 rounded-xl p-6 shadow text-center">
      <i class="fas fa-coins text-yellow-600 text-2xl mb-2"></i>
      <div class="text-lg font-semibold">Total Cost</div>
      <div class="text-2xl font-bold text-yellow-700">{{ total_cost }}‡ß≥</div>
    </div>

    <!-- Export -->
    <div class="bg-blue-50 rounded-xl p-6 shadow text-center">
      <i class="fas fa-file-excel text-blue-600 text-2xl mb-2"></i>
      <div class="text-lg font-semibold">Export Summary</div>
      <a href="{% url 'managers:export_monthly_summary' %}?month={{ selected_month }}"
         class="inline-block bg-blue-600 hover:bg-blue-700 text-white mt-3 px-4 py-2 rounded-lg shadow transition">
        <i class="fas fa-download mr-1"></i> Download Excel
      </a>
    </div>

    <!-- Regenerate Summary -->
    <div class="bg-orange-50 rounded-xl p-6 shadow text-center">
      <i class="fas fa-sync-alt text-orange-600 text-2xl mb-2"></i>
      <div class="text-lg font-semibold">Regenerate Summary</div>
      <a href="{% url 'managers:regenerate_monthly_summary' selected_month %}"
        class="inline-block bg-red-500 hover:bg-red-700 text-white mt-3 px-4 py-2 rounded-lg shadow transition">
        <i class="fas fa-redo mr-1"></i> Regenerate Now
      </a>
    </div>
  </div>

  <!-- Preference Breakdown -->
  <div class="grid md:grid-cols-2 gap-6 mb-10">
    <div class="bg-white rounded-xl shadow p-6 text-center border-t-4 border-red-500">
      <h4 class="text-lg font-semibold text-red-700 mb-2">ü•© Beef Preference</h4>
      <p class="text-gray-600">Eat Beef: <span class="font-bold text-green-700">{{ beef_count }}</span></p>
      <p class="text-gray-600">Don‚Äôt Eat Beef (Mutton): <span class="font-bold text-red-700">{{ no_beef_count }}</span></p>
    </div>

    <div class="bg-white rounded-xl shadow p-6 text-center border-t-4 border-blue-500">
      <h4 class="text-lg font-semibold text-blue-700 mb-2">üêü Fish Preference</h4>
      <p class="text-gray-600">Eat Fish: <span class="font-bold text-green-700">{{ fish_count }}</span></p>
      <p class="text-gray-600">Don‚Äôt Eat Fish (Egg): <span class="font-bold text-red-700">{{ no_fish_count }}</span></p>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto bg-white shadow rounded-xl border border-gray-200">
    <table class="min-w-full text-left border-collapse">
      <thead class="bg-indigo-600 text-white">
        <tr>
          <!-- Sortable Headers -->
          <th class="px-4 py-3">
            <a href="?month={{ selected_month }}&sort=room"
               class="flex items-center space-x-1 hover:underline">
              <span>Room</span>
              {% if sort_by == 'room' %}<i class="fas fa-sort-amount-down-alt"></i>{% endif %}
            </a>
          </th>
          <th class="px-4 py-3">Student</th>
          <th class="px-4 py-3">
            <a href="?month={{ selected_month }}&sort=days"
               class="flex items-center space-x-1 hover:underline">
              <span>Total ON Days</span>
              {% if sort_by == 'days' %}<i class="fas fa-sort-amount-down-alt"></i>{% endif %}
            </a>
          </th>
          <th class="px-4 py-3">Beef</th>
          <th class="px-4 py-3">Fish</th>
          <th class="px-4 py-3">
            <a href="?month={{ selected_month }}&sort=cost"
               class="flex items-center space-x-1 hover:underline">
              <span>Total Cost</span>
              {% if sort_by == 'cost' %}<i class="fas fa-sort-amount-down-alt"></i>{% endif %}
            </a>
          </th>
        </tr>
      </thead>
      <tbody>
        {% for summary in summaries %}
        <tr class="border-b hover:bg-indigo-50 transition">
          <td class="px-4 py-3">{{ summary.student.room_number }}</td>
          <td class="px-4 py-3 font-medium">{{ summary.student.name }}</td>
          <td class="px-4 py-3">{{ summary.total_on_days }}</td>
          <td class="px-4 py-3">
            {% if summary.prefers_beef %}
              <span class="text-green-700 font-semibold">Beef</span>
            {% else %}
              <span class="text-red-600 font-semibold">Mutton</span>
            {% endif %}
          </td>
          <td class="px-4 py-3">
            {% if summary.prefers_fish %}
              <span class="text-green-700 font-semibold">Fish</span>
            {% else %}
              <span class="text-red-600 font-semibold">Egg</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 font-semibold text-indigo-700">{{ summary.total_cost }}‡ß≥</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>
{% endblock %}
